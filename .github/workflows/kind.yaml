name: "KinD cluster test"
on: [pull_request, push]

jobs:
  kind:    
    strategy:
        matrix:
          k8s-version: ['v1.16.9', 'v1.17.5', 'v1.18.6']
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - uses: engineerd/setup-kind@v0.4.0
      with:
          name: dev
          config: kind/kind-config.yaml
          image: kindest/node:${{ matrix.k8s-version }}
          version: v0.8.1          
    - name: Testing
      run: |
        kubectl cluster-info
        docker build -t haproxytech/kubernetes-ingress -f build/Dockerfile .
        kind --name=dev load docker-image haproxytech/kubernetes-ingress:latest